# 좌표 제거 이미지화를 통한 악성 안드로이드 애플리케이션 탐지(malware-dectection-with-ml)
- [1.개요](#참고문헌)
  * [요약](#--)
  * [연구배경](#----)
  * [연구목표](#----)
- [2.구현](#2--)
  * [Steps](#steps)
  * [Current](#current)
- [참고문헌](#----)



## 1.개요
### 요약
최근 스마트 디바이스 사용이 기하급수적으로 증가함에 따라 그를 노린 악성 프로그램이 증가하고 그 위협을 방지하는 것이 중요해지고 있다. 이러한 악성 프로그램 탐지에 머신러닝을 적용하여 기존의 방법으로 대응하기 힘들었던 신종 및 변종 악성 프로그램에 대응할 수 있게 되었다. 본 연구에서는 안드로이드 애플리케이션 파일 전체를 이미지화하고 좌표 제거 방법을 적용한 데이터 전처리를 통해 악성 안드로이드 애플리케이션 탐지 실험을 진행한다.

### 연구배경
기존의 악성 프로그램 판별 시스템은 악성 프로그램에 대한 시그니처를 생성하고 이를 기반으로 프로그램의 악성 유무를 판별하는 방식이었다. 하지만 이 방식은 실시간으로 나타나는 신종 또는 변종 악성 프로그램에 대응하는 것이 불가능하다는 단점이 있다.

최근 위와 같은 단점을 보완하기 위해 악성 프로그램 탐지 시스템에 ML(머신러닝)을 적용한 연구가 진행되고 있다. 악성 프로그램은 일반적으로 악성코드 패밀리에 따라 사용되는 라이브러리, 컴파일러 등에서 유사한 특징을 보이기 때문에 이러한 특징을 feature로 설정한 연구들이 진행되었고, 그 결과 악성 프로그램 분류가 가능했다 [1] [2]. 안드로이드 애플리케이션의 경우, 호출 API의 종류와 횟수 [3], 권한 정보 [4], 네트워크 트래픽 [5] 등에서 악성과 정상 애플리케이션간 차이점을 보였고, 이를 featrue로 설정하여 연구를 진행한 결과, 악성 애플리케이션 탐지가 가능했다.

### 연구목표
위와 같이 악성 프로그램 탐지에 ML을 적용하는 경우, 대부분 악성 프로그램의 특징을 별도의 과정을 통해 추출하고 feature로 설정하여 학습을 진행한다. 일반적인 악성코드의 경우, 전체 프로그램 파일을 input으로 하여 학습시키는 경우도 있지만 [1], 예측 정확도를 높이기 위해 악성코드의 PE헤더 [2] 등 프로그램의 특정 부분을 추출하여 학습시키는 경우가 많다. 특히, 국내에서 진행된 악성 안드로이드 애플리케이션 탐지 연구의 경우, 대부분 애플리케이션의 특정 부분을 추출하여 연구를 진행하고 있다.

하지만 특징 추출에는 비용이 발생한다. 만약 특징 추출이 아닌 파일 전체를 input으로 하여 분류가 가능해진다면 <u>**데이터 전처리 비용을 줄여 cost-effective한 시스템**</u>을 개발할 수 있다. 따라서 본 연구에서는 악성 안드로이드 애플리케이션 탐지에 있어서 특징 데이터 추출을 통해 feature를 설정하고 학습시킨 국내 대부분의 연구와 달리, <u>**애플리케이션 파일 전체를 전처리하여 만들어진 이미지를 사용하여 악성 애플리케이션을 탐지**</u>하는 연구를 진행한다. 특히, 이미지를 생성하는 전처리 과정에서 정확도를 높이기 위해 <u>**좌표 제거 방법**</u>을 제안한다. 좌표 제거 방법 적용 전, 후의 실험을 진행하여 결과를 분석하고, 마지막으로 본 연구의 한계점과 향후 연구 방향을 제시한다.


## 2.구현 및 실험
### 실험 데이터 및 실험 방식
악성 안드로이드 애플리케이션 탐지 실험을 진행하기 위한 데이터에는 ‘2018 정보보호 R&D 데이터 챌린지 – AI기반 안드로이드 악성앱 탐지 트랙’ [6]의 KU-CISC2018-Android-Pre-Train, KU-CISC2018-Android-Pre-Test, KU-CISC2018-Android-Final-2nd-Test를 사용하였다. 이 중, 중복을 제외한 Normal application 8,024개, Malware application 3,829개, 총 11,853개의 애플리케이션을 사용하였다. Training set에는 80%인 9,483개를, Validation set에는 20%인 2,370개를 사용하였다.

[1]에 따르면 일반적인 프로그램에 IC 및 SO 기법을 사용하여 이미지 분류를 진행하였을 때, IC 기법을 적용한 프로그램의 악성 탐지 정확도가 더 높게 나왔다. 따라서 이미지화 방법으로는 2 Bytes를 (1 Byte, 1 Byte) = (0\~255, 0\~255) 좌표에 대응시키는 IC(Incremental Coordinate) 방법을 사용하였다.

실험은 Google Colab 일반 GPU 환경에서 이루어졌으며, 실험에 사용한 이미지 분류 모델은 Input size=260x260인 EfficientNet-V2이다. 학습은 TensorFlow가 제공하는 Coding tutorial ‘Retraining an image classifier’를 토대로 진행했다 [7].


### Steps

### 1) 전체 파일 이미지화 : IC(Incremental Coordinate)
#### 구현방법
#### 구현
#### 실험결과

### 2) 좌표제거 방법
#### 구현방법
#### 구현
#### 생성 이미지 비교
### 3) 최종 결과 비교


### Current 
test.cpp
```
#include<iostream>
using namespace std;

int main(){
    cout << "Hello World!!" << endl;
    return 0;
}
```
test.cpp 시각화   
![test_cpp_code_image](https://user-images.githubusercontent.com/41164017/161964903-6aed7d77-b83a-45e2-b3b2-14ad73735c5d.png)


mp3_ex_3200kb_197s.mp3 시각화   
![test](https://user-images.githubusercontent.com/41164017/163862955-ba0234f0-8c72-435d-9cb5-c6ee73fdbf9f.jpg)
   
time compare   
![prev_ver](https://user-images.githubusercontent.com/41164017/163863034-8cba4db3-13f2-4845-b2a0-d91f4cd2e080.png)
   
![impr_ver1](https://user-images.githubusercontent.com/41164017/163863046-2421c8e5-18f3-4799-92e3-429da8cc897a.png)




## 참고문헌
- [1] 김형겸, 한석민, 이수철, 이준락, “딥러닝 기술을 활용한 멀웨어 분류를 위한 이미지화 기법”, 인터넷 정보학회논문지, Vol.19, No.5, 67-75, 2018.
- [2] 박지현, 김태옥, 신유림, 김지연, 최은정, “악성코드의 이미지 기반 딥러닝을 위한 전처리 방법 설계 및 개발”, 멀티미디어학회 논문지, Vol.23, No.5, 650-657 2020.
- [3] 김진섭, 김연어, 우균, “기계학습을 이용한 안드로이드 악성코드 탐지 기법”, 한국컴퓨터종합학술대회 논문집, 2018.
- [4] 강성은, 응웬부렁, 정수환, “머신러닝을 이용한 권한 기반 안드로이드 악성코드 탐지”, 정보보호학회 논문지, Vol.28, No.3, 617-623, 2018.
- [5] 강진원, 이수진, “네트워크 트래픽 이미지화를 통한 안드로이드 악성코드 탐지”, 정보과학회논문지, Vol.47, No.8, 761-768, 2020.
- [6] HCR Lab, 고려대학교 KU-CISC2018-Android, https://ocslab,hksecurity.net/Datasets/datachallenge2018/android, 2018.
- [7] TF Hub for TF2: Retraining an image classifier, https://colab.research.google.com/github/tensorflow/hub/blob/master/examples/colab/tf2_image_retraining.ipynb, 2021.
